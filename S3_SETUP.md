# S3 Media Setup Guide

This guide explains how to configure S3 for serving images and videos on the Nealy Event Decor website.

## S3 Bucket Structure

Your S3 bucket (`nealy-decor-bucket`) is organized as follows:

```
nealy-decor-bucket/
└── 01-Website-Creation/
    ├── 01 Landing Page/      (Banner images, entrance videos)
    ├── 02 Home Page/          (Home page images and videos)
    ├── 03 Gallery/            (Gallery images)
    ├── 04 Services/           (Services page images)
    ├── 05 About/              (About page images and videos)
    ├── 06 Contact/            (Contact page images)
    └── 07 Rentals/            (Rental item images)
```

## Environment Variables

Add these to your `.env.local` file:

```bash
# S3 Configuration
NEXT_PUBLIC_S3_BUCKET_NAME=nealy-decor-bucket
NEXT_PUBLIC_S3_REGION=us-east-1

# Optional: CloudFront CDN domain (for faster delivery)
# NEXT_PUBLIC_S3_CLOUDFRONT_DOMAIN=d1234567890.cloudfront.net

# Legacy Cloudinary (optional - for backward compatibility)
# NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME=your-cloudinary-cloud-name
```

## S3 Bucket Configuration

### 1. Public Access Settings

For the images/videos to be publicly accessible, configure your S3 bucket:

1. Go to S3 Console → Your bucket → **Permissions** tab
2. **Block public access** → Edit → Uncheck "Block all public access"
3. **Bucket Policy** → Add this policy:

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "PublicReadGetObject",
      "Effect": "Allow",
      "Principal": "*",
      "Action": "s3:GetObject",
      "Resource": "arn:aws:s3:::nealy-decor-bucket/*"
    }
  ]
}
```

**Important**: Replace `nealy-decor-bucket` with your actual bucket name.

### 2. CORS Configuration

Add CORS configuration for Next.js Image optimization:

```json
[
  {
    "AllowedHeaders": ["*"],
    "AllowedMethods": ["GET", "HEAD"],
    "AllowedOrigins": [
      "http://localhost:3000",
      "https://your-domain.com"
    ],
    "ExposeHeaders": ["ETag"],
    "MaxAgeSeconds": 3000
  }
]
```

## CloudFront CDN Setup (Recommended)

For faster image/video delivery, set up CloudFront:

1. **Create CloudFront Distribution**:
   - Origin: Your S3 bucket (`nealy-decor-bucket.s3.us-east-1.amazonaws.com`)
   - Origin Access: Select "Origin access control settings"
   - Default Cache Behavior: Allow GET, HEAD

2. **Update S3 Bucket Policy** for CloudFront:
   - Use the policy generated by CloudFront when creating OAC

3. **Set Environment Variable**:
   ```bash
   NEXT_PUBLIC_S3_CLOUDFRONT_DOMAIN=your-cloudfront-domain.cloudfront.net
   ```

## File Naming Convention

### Images
- Use descriptive filenames without spaces (use hyphens or underscores)
- Supported formats: `.jpg`, `.jpeg`, `.png`, `.webp`
- Example: `HP_Banner.png`, `italian-romance.jpg`

### Videos
- Supported formats: `.mp4`, `.webm`, `.mov`
- Keep filenames simple and descriptive
- Example: `Video-no-text.mp4`, `about.mp4`

## Uploading Files

### Method 1: AWS Console (Web Interface)
1. Navigate to your bucket in S3 Console
2. Go to the appropriate folder (e.g., `01-Website-Creation/03 Gallery/`)
3. Click "Upload" → Select files → Upload

### Method 2: AWS CLI
```bash
# Upload a single file
aws s3 cp image.jpg s3://nealy-decor-bucket/01-Website-Creation/03\ Gallery/image.jpg

# Upload entire folder
aws s3 sync ./local-folder s3://nealy-decor-bucket/01-Website-Creation/03\ Gallery/
```

### Method 3: AWS SDK (Programmatic)
You can create a script to upload files programmatically if needed.

## Usage in Code

### Images

```typescript
import { getS3ImageBySection } from '@/lib/media/s3';

// Get image from specific section
const imageUrl = getS3ImageBySection('gallery', 'IMG_0936.jpg');
// Returns: https://nealy-decor-bucket.s3.us-east-1.amazonaws.com/01-Website-Creation/03 Gallery/IMG_0936.jpg
```

### Videos

```typescript
import { getVideoUrl } from '@/lib/media/videoUrls';

// Get video URL
const videoUrl = getVideoUrl('about');
// Returns: S3 URL for about.mp4 in "05 About/" folder
```

## Migration from Cloudinary

The system automatically falls back to Cloudinary if S3 is not configured:

1. **Priority Order**:
   - S3 (if `NEXT_PUBLIC_S3_BUCKET_NAME` is set)
   - Cloudinary (if `NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME` is set)
   - Local paths (development fallback)

2. **Gradual Migration**:
   - Start by setting S3 environment variables
   - Upload files to S3 matching the folder structure
   - Test with S3 enabled
   - Remove Cloudinary once everything is verified

## Troubleshooting

### Images not loading
- Check bucket public access settings
- Verify file paths match exactly (including spaces in folder names)
- Check CORS configuration
- Verify environment variables are set correctly

### CORS errors
- Update CORS configuration in S3 bucket
- Include your domain in allowed origins
- Check browser console for specific CORS error messages

### CloudFront issues
- Verify CloudFront distribution is deployed
- Check origin access settings
- Ensure S3 bucket policy allows CloudFront access
- Clear CloudFront cache if needed

## Best Practices

1. **Optimize images before upload** (use tools like ImageOptim, TinyPNG)
2. **Use descriptive filenames** for easier management
3. **Organize files** in appropriate folders according to the structure
4. **Use CloudFront** for production for faster delivery
5. **Monitor S3 costs** (storage, requests, data transfer)

## Cost Optimization

- Enable S3 Lifecycle policies to move old files to cheaper storage tiers
- Use CloudFront caching to reduce S3 requests
- Optimize image sizes before upload
- Consider using S3 Intelligent-Tiering for automatic cost optimization

